package nema

import (
	"encoding/json"
	"time"
)

type neuro struct {
	StateCount     int            `json:"state_count"`
	UpdatedAt      time.Time      `json:"updated_at"`
	MotorNeurons   map[string]int `json:"motor_neurons"`
	SensoryNeurons map[string]int `json:"sensory_neurons"`
}

func NewNeuro() neuro {
	return neuro{
		StateCount:     0,
		UpdatedAt:      time.Now(),
		MotorNeurons:   initialMotorNeuronStates,
		SensoryNeurons: initialSensoryNeuronStates,
	}
}

func (n *neuro) updateMotorNeuron(neuron string, state int) {
	if !validValue(state) {
		return
	}
	n.MotorNeurons[neuron] = state
}

func (n *neuro) updateSensoryNeuron(neuron string, state int) {
	if !validValue(state) {
		return
	}
	n.SensoryNeurons[neuron] = state
}

func validValue(value int) bool {
	return value > -129 && value < 128
}

// JSONString returns the Neuro object as a pretty JSON string with indents and
// newlines.
func (n *neuro) JSONString() string {
	json, err := json.MarshalIndent(n, "", "  ")
	if err != nil {
		return ""
	}
	return string(json)
}

var initialMotorNeuronStates = map[string]int{
	"N_MANAL":  0,
	"N_MDL01":  0,
	"N_MDL02":  0,
	"N_MDL03":  0,
	"N_MDL04":  0,
	"N_MDL05":  0,
	"N_MDL06":  0,
	"N_MDL07":  0,
	"N_MDL08":  0,
	"N_MDL09":  0,
	"N_MDL10":  0,
	"N_MDL11":  0,
	"N_MDL12":  0,
	"N_MDL13":  0,
	"N_MDL14":  0,
	"N_MDL15":  0,
	"N_MDL16":  0,
	"N_MDL17":  0,
	"N_MDL18":  0,
	"N_MDL19":  0,
	"N_MDL20":  0,
	"N_MDL21":  0,
	"N_MDL22":  0,
	"N_MDL23":  0,
	"N_MDL24":  0,
	"N_MDR01":  0,
	"N_MDR02":  0,
	"N_MDR03":  0,
	"N_MDR04":  0,
	"N_MDR05":  0,
	"N_MDR06":  0,
	"N_MDR07":  0,
	"N_MDR08":  0,
	"N_MDR09":  0,
	"N_MDR10":  0,
	"N_MDR11":  0,
	"N_MDR12":  0,
	"N_MDR13":  0,
	"N_MDR14":  0,
	"N_MDR15":  0,
	"N_MDR16":  0,
	"N_MDR17":  0,
	"N_MDR18":  0,
	"N_MDR19":  0,
	"N_MDR20":  0,
	"N_MDR21":  0,
	"N_MDR22":  0,
	"N_MDR23":  0,
	"N_MDR24":  0,
	"N_MI":     0,
	"N_MVL01":  0,
	"N_MVL02":  0,
	"N_MVL03":  0,
	"N_MVL04":  0,
	"N_MVL05":  0,
	"N_MVL06":  0,
	"N_MVL07":  0,
	"N_MVL08":  0,
	"N_MVL09":  0,
	"N_MVL10":  0,
	"N_MVL11":  0,
	"N_MVL12":  0,
	"N_MVL13":  0,
	"N_MVL14":  0,
	"N_MVL15":  0,
	"N_MVL16":  0,
	"N_MVL17":  0,
	"N_MVL18":  0,
	"N_MVL19":  0,
	"N_MVL20":  0,
	"N_MVL21":  0,
	"N_MVL22":  0,
	"N_MVL23":  0,
	"N_MVR01":  0,
	"N_MVR02":  0,
	"N_MVR03":  0,
	"N_MVR04":  0,
	"N_MVR05":  0,
	"N_MVR06":  0,
	"N_MVR07":  0,
	"N_MVR08":  0,
	"N_MVR09":  0,
	"N_MVR10":  0,
	"N_MVR11":  0,
	"N_MVR12":  0,
	"N_MVR13":  0,
	"N_MVR14":  0,
	"N_MVR15":  0,
	"N_MVR16":  0,
	"N_MVR17":  0,
	"N_MVR18":  0,
	"N_MVR19":  0,
	"N_MVR20":  0,
	"N_MVR21":  0,
	"N_MVR22":  0,
	"N_MVR23":  0,
	"N_MVR24":  0,
	"N_MVULVA": 0,
}

var initialSensoryNeuronStates = map[string]int{
	"N_ADAL":  4,
	"N_ADAR":  30,
	"N_ADEL":  28,
	"N_ADER":  4,
	"N_ADFL":  13,
	"N_ADFR":  15,
	"N_ADLL":  14,
	"N_ADLR":  29,
	"N_AFDL":  29,
	"N_AFDR":  27,
	"N_AIAL":  44,
	"N_AIAR":  40,
	"N_AIBL":  5,
	"N_AIBR":  12,
	"N_AIML":  29,
	"N_AIMR":  2,
	"N_AINL":  18,
	"N_AINR":  15,
	"N_AIYL":  3,
	"N_AIYR":  5,
	"N_AIZL":  29,
	"N_AIZR":  11,
	"N_ALA":   29,
	"N_ALML":  4,
	"N_ALMR":  1,
	"N_ALNL":  0,
	"N_ALNR":  0,
	"N_AQR":   15,
	"N_AS1":   31,
	"N_AS10":  8,
	"N_AS11":  18,
	"N_AS2":   16,
	"N_AS3":   7,
	"N_AS4":   6,
	"N_AS5":   9,
	"N_AS6":   25,
	"N_AS7":   17,
	"N_AS8":   6,
	"N_AS9":   26,
	"N_ASEL":  18,
	"N_ASER":  30,
	"N_ASGL":  16,
	"N_ASGR":  21,
	"N_ASHL":  31,
	"N_ASHR":  5,
	"N_ASIL":  0,
	"N_ASIR":  5,
	"N_ASJL":  2,
	"N_ASJR":  29,
	"N_ASKL":  7,
	"N_ASKR":  0,
	"N_AUAL":  22,
	"N_AUAR":  8,
	"N_AVAL":  108,
	"N_AVAR":  45,
	"N_AVBL":  34,
	"N_AVBR":  28,
	"N_AVDL":  2,
	"N_AVDR":  1,
	"N_AVEL":  11,
	"N_AVER":  38,
	"N_AVFL":  36,
	"N_AVFR":  0,
	"N_AVG":   11,
	"N_AVHL":  28,
	"N_AVHR":  17,
	"N_AVJL":  28,
	"N_AVJR":  28,
	"N_AVKL":  5,
	"N_AVKR":  18,
	"N_AVL":   15,
	"N_AVM":   2,
	"N_AWAL":  24,
	"N_AWAR":  0,
	"N_AWBL":  15,
	"N_AWBR":  22,
	"N_AWCL":  5,
	"N_AWCR":  29,
	"N_BAGL":  31,
	"N_BAGR":  13,
	"N_BDUL":  6,
	"N_BDUR":  16,
	"N_CEPDL": 30,
	"N_CEPDR": 26,
	"N_CEPVL": -125,
	"N_CEPVR": 26,
	"N_DA1":   26,
	"N_DA2":   30,
	"N_DA3":   22,
	"N_DA4":   15,
	"N_DA5":   10,
	"N_DA6":   21,
	"N_DA7":   0,
	"N_DA8":   13,
	"N_DA9":   4,
	"N_DB1":   1,
	"N_DB2":   23,
	"N_DB3":   11,
	"N_DB4":   0,
	"N_DB5":   10,
	"N_DB6":   13,
	"N_DB7":   19,
	"N_DD1":   24,
	"N_DD2":   0,
	"N_DD3":   29,
	"N_DD4":   22,
	"N_DD5":   8,
	"N_DD6":   -3,
	"N_DVA":   8,
	"N_DVB":   0,
	"N_DVC":   24,
	"N_FLPL":  8,
	"N_FLPR":  19,
	"N_HSNL":  18,
	"N_HSNR":  0,
	"N_I1L":   0,
	"N_I1R":   0,
	"N_I2L":   0,
	"N_I2R":   0,
	"N_I3":    0,
	"N_I4":    0,
	"N_I5":    0,
	"N_I6":    0,
	"N_IL1DL": 0,
	"N_IL1DR": 2,
	"N_IL1L":  4,
	"N_IL1R":  24,
	"N_IL1VL": -68,
	"N_IL1VR": 23,
	"N_IL2DL": 18,
	"N_IL2DR": 0,
	"N_IL2L":  0,
	"N_IL2R":  2,
	"N_IL2VL": 3,
	"N_IL2VR": 24,
	"N_LUAL":  21,
	"N_LUAR":  23,
	"N_M1":    8,
	"N_M2L":   0,
	"N_M2R":   0,
	"N_M3L":   0,
	"N_M3R":   0,
	"N_M4":    0,
	"N_M5":    0,
	"N_MCL":   29,
	"N_MCR":   2,
	"N_NSML":  23,
	"N_NSMR":  18,
	"N_OLLL":  0,
	"N_OLLR":  3,
	"N_OLQDL": 12,
	"N_OLQDR": 28,
	"N_OLQVL": 27,
	"N_OLQVR": 29,
	"N_PDA":   0,
	"N_PDB":   3,
	"N_PDEL":  1,
	"N_PDER":  0,
	"N_PHAL":  19,
	"N_PHAR":  25,
	"N_PHBL":  7,
	"N_PHBR":  0,
	"N_PHCL":  1,
	"N_PHCR":  0,
	"N_PLML":  14,
	"N_PLMR":  31,
	"N_PLNL":  19,
	"N_PLNR":  16,
	"N_PQR":   0,
	"N_PVCL":  26,
	"N_PVCR":  25,
	"N_PVDL":  12,
	"N_PVDR":  22,
	"N_PVM":   2,
	"N_PVNL":  0,
	"N_PVNR":  7,
	"N_PVPL":  11,
	"N_PVPR":  20,
	"N_PVQL":  15,
	"N_PVQR":  5,
	"N_PVR":   4,
	"N_PVT":   29,
	"N_PVWL":  19,
	"N_PVWR":  0,
	"N_RIAL":  7,
	"N_RIAR":  0,
	"N_RIBL":  1,
	"N_RIBR":  6,
	"N_RICL":  16,
	"N_RICR":  26,
	"N_RID":   30,
	"N_RIFL":  23,
	"N_RIFR":  33,
	"N_RIGL":  27,
	"N_RIGR":  14,
	"N_RIH":   21,
	"N_RIML":  21,
	"N_RIMR":  22,
	"N_RIPL":  -127,
	"N_RIPR":  -66,
	"N_RIR":   -119,
	"N_RIS":   -79,
	"N_RIVL":  -127,
	"N_RIVR":  -128,
	"N_RMDDL": -123,
	"N_RMDDR": -123,
	"N_RMDL":  8,
	"N_RMDR":  22,
	"N_RMDVL": 7,
	"N_RMDVR": 18,
	"N_RMED":  1,
	"N_RMEL":  10,
	"N_RMER":  31,
	"N_RMEV":  26,
	"N_RMFL":  23,
	"N_RMFR":  14,
	"N_RMGL":  26,
	"N_RMGR":  19,
	"N_RMHL":  8,
	"N_RMHR":  19,
	"N_SAADL": 5,
	"N_SAADR": 7,
	"N_SAAVL": 24,
	"N_SAAVR": 0,
	"N_SABD":  26,
	"N_SABVL": -128,
	"N_SABVR": -127,
	"N_SDQL":  -127,
	"N_SDQR":  3,
	"N_SIADL": 12,
	"N_SIADR": 14,
	"N_SIAVL": 9,
	"N_SIAVR": 32,
	"N_SIBDL": 22,
	"N_SIBDR": 23,
	"N_SIBVL": 23,
	"N_SIBVR": 13,
	"N_SMBDL": -123,
	"N_SMBDR": -104,
	"N_SMBVL": -124,
	"N_SMBVR": -127,
	"N_SMDDL": 1,
	"N_SMDDR": 0,
	"N_SMDVL": 0,
	"N_SMDVR": 0,
	"N_URADL": 20,
	"N_URADR": 18,
	"N_URAVL": 6,
	"N_URAVR": 18,
	"N_URBL":  10,
	"N_URBR":  4,
	"N_URXL":  12,
	"N_URXR":  26,
	"N_URYDL": 0,
	"N_URYDR": 14,
	"N_URYVL": 23,
	"N_URYVR": 25,
	"N_VA1":   33,
	"N_VA10":  25,
	"N_VA11":  3,
	"N_VA12":  32,
	"N_VA2":   10,
	"N_VA3":   12,
	"N_VA4":   0,
	"N_VA5":   36,
	"N_VA6":   8,
	"N_VA7":   3,
	"N_VA8":   29,
	"N_VA9":   15,
	"N_VB1":   17,
	"N_VB10":  18,
	"N_VB11":  -2,
	"N_VB2":   16,
	"N_VB3":   30,
	"N_VB4":   17,
	"N_VB5":   20,
	"N_VB6":   24,
	"N_VB7":   28,
	"N_VB8":   7,
	"N_VB9":   3,
	"N_VC1":   5,
	"N_VC2":   0,
	"N_VC3":   31,
	"N_VC4":   18,
	"N_VC5":   2,
	"N_VC6":   7,
	"N_VD1":   22,
	"N_VD10":  12,
	"N_VD11":  19,
	"N_VD12":  0,
	"N_VD13":  0,
	"N_VD2":   0,
	"N_VD3":   0,
	"N_VD4":   0,
	"N_VD5":   0,
	"N_VD6":   0,
	"N_VD7":   0,
	"N_VD8":   0,
	"N_VD9":   19,
}
